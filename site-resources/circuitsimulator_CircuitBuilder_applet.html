<!DOCTYPE html>
<html>
<head>
<title>SwingJS test CircuitBuilder</title><meta charset="utf-8" />
<script src="swingjs/swingjs2.js"></script>
<script>


var id=new Array();
var gidV=0;
var noc=10;
var timerID=0;
function initPage(){
	if (!dataGraphApp || !dataGraphApp._applet) return;
	dataGraph=dataGraphApp._applet;
	if (!circuitApp || !circuitApp._applet) return;
	circuit=circuitApp._applet;
	clearTimeout(timerID);
	timerID=0;
	id[0]=0;
	id[6]=0;
	document.Function.reset();
	value=document.Function.A1.value;
	if(!checkRange(value,0.5,5)){
		alert("The input value must be between 0.5 and 5 (microFarads). Your value is "+value);
		return;
	}
	value=document.Function.A2.value;
	if(!checkRange(value,10,1000)){
		alert("The resistor value must be between 10 and 1000. Your value is "+value);
		return;
	}
	value=document.Function.A3.value;
	if(!checkRange(value,0.5,5)){
		alert("The battery value must be between 0.5 and 5. Your value is "+value);
		return;
	}
	circuit.pause();
	circuit.setDefault();
	circuit.setNumberOfDT(noc);
	circuit.setDT(1.0e-6);
	circuit.setNOC(noc);
	circuit.setFPS(10);
	c1=eval(document.Function.A1.value)/1e6;
	r1=eval(document.Function.A2.value);
	batt1=eval(document.Function.A3.value);
	cvalue=eval(document.Function.A1.value);
	circuit.setGrid("rows=3,cols=3");
	id[0]=circuit.addObject("switch", "row=0,col=0,to=h,open=0");
	id[1]=circuit.addObject("resistor", "row=0,col=2,to=v,r="+r1);
	id[2]=circuit.addObject("capacitor", "row=1,col=2,to=v,c="+c1);
	//circuit.setLabel(id[2], "Capacitor");
	circuit.setFormat(id[2], "%6.2g");
	//circuit.setValueVisible(id[2],0);
	id[3]=circuit.addObject("wire", "row=1,col=0,to=h");
	id[4]=circuit.addObject("wire", "row=1,col=0,to=v");
	circuit.addObject("wire", "row=2,col=0,to=h");
	circuit.addObject("wire", "row=0,col=1,to=h");
	circuit.addObject("wire", "row=2,col=1,to=h");
	id[5]=circuit.addObject("battery", "row=0,col=0,d=-1,to=v,v="+batt1);
	id[6]=circuit.addObject("switch", "row=0,col=1,to=v,open=1");
	circuit.parse();
	resetC();
	circuit.deleteDataConnections();
	circuit.makeDataConnection(id[2],gidV,1, "t", "-v");
	circuit.makeDataConnection(id[1],gidV,2, "t", "-v");
	circuit.makeDataConnection(id[6],gidV,3, "t", "-v");
	circuit.updateDataConnections();
}
function build1(){
	timerID=0;
	value=document.Function.A1.value;
	if(!checkRange(value,0.5,5)){
		alert("The input value must be between 0.5 and 5 (microFarads). Your value is "+value);
		return;
	}
	value=document.Function.A2.value;
	if(!checkRange(value,10,1000)){
		alert("The resistor value must be between 10 and 1000. Your value is "+value);
		return;
	}
	value=document.Function.A3.value;
	if(!checkRange(value,0.5,5)){
		alert("The battery value must be between 0.5 and 5. Your value is "+value);
		return;
	}
	c1=eval(document.Function.A1.value)/1e6;
	r1=eval(document.Function.A2.value);
	batt1=eval(document.Function.A3.value);
	cvalue=eval(document.Function.A1.value);
	circuit.pause();
	circuit.setDefault();
	circuit.setNumberOfDT(noc);
	circuit.setDT(1.0e-6);
	circuit.setNOC(noc);
	circuit.setFPS(10);
	circuit.setGrid("rows=3,cols=3");
	id[0]=circuit.addObject("switch", "row=0,col=0,to=h,open=0");
	id[1]=circuit.addObject("resistor", "row=0,col=2,to=v,r="+r1);
	id[2]=circuit.addObject("capacitor", "row=1,col=2,to=v,c="+c1);
	//circuit.setLabel(id[2], "Capacitor");
	circuit.setFormat(id[2], "%6.2g");
	//circuit.setValueVisible(id[2],0);
	id[3]=circuit.addObject("wire", "row=1,col=0,to=h");
	id[4]=circuit.addObject("wire", "row=1,col=0,to=v");
	circuit.addObject("wire", "row=2,col=0,to=h");
	circuit.addObject("wire", "row=0,col=1,to=h");
	circuit.addObject("wire", "row=2,col=1,to=h");
	id[5]=circuit.addObject("battery", "row=0,col=0,d=-1,to=v,v="+batt1);
	id[6]=circuit.addObject("switch", "row=0,col=1,to=v,open=1");
	circuit.parse();
	resetC();
	circuit.deleteDataConnections();
	circuit.makeDataConnection(id[2],gidV,1, "t", "-v");
	circuit.makeDataConnection(id[1],gidV,2, "t", "-v");
	circuit.makeDataConnection(id[6],gidV,3, "t", "-v");
	circuit.updateDataConnections();
	circuit.forward();
}
function change(){
	v=0.0;//dummy value
	circuit.pause();
	circuit.setValue(id[6],"0");
	circuit.setValue(id[0],"0");
	circuit.forward();
}
function resetC(){
	isRunning=circuit.isClockRunning();
	circuit.reset();
	dataGraph.clearSeries(1);
	dataGraph.clearSeries(2);
	dataGraph.clearSeries(3);
	dataGraph.setSeriesRGB(1,255,0,0);
	dataGraph.setSeriesRGB(2,0,255,0);
	dataGraph.setSeriesRGB(3,0,0,255);
	dataGraph.setSeriesStyle(1,true,3);
	dataGraph.setSeriesStyle(2,true,3);
	dataGraph.setSeriesStyle(3,true,3);
	dataGraph.setLastPointMarker(1,true);
	dataGraph.setMarkerSize(1,0.6);
	dataGraph.setLastPointMarker(2,true);
	dataGraph.setMarkerSize(2,0.6);
	dataGraph.setLastPointMarker(3,true);
	dataGraph.setMarkerSize(3,0.6);
	dataGraph.setLabelX("Time (s)");
	dataGraph.setLabelY("Voltage (V)");
	dataGraph.setMouseFormat("%3.1e");
	gidV=dataGraph.getGraphID();
	if(isRunning)circuit.forward();
}
	


if (!self.SwingJS)alert('swingjs2.js was not found. It needs to be in swingjs folder in the same directory as ' + document.location.href)
Info = {
  code: "circuitsimulator.CircuitBuilder",
  main: null,
  core: "none",
	width: 850,
	height: 550,
  readyFunction: initPage,
	serverURL: 'https://chemapps.stolaf.edu/jmol/jsmol/php/jsmol.php',
	j2sPath: 'swingjs/j2s',
	console:'sysoutdiv',
	allowjavascript: true
}
</script>
</head>
<body>
<script>
SwingJS.getApplet('testApplet', Info)
getClassList = function(){J2S.saveFile('_j2sclasslist.txt', Clazz.ClassFilesLoaded.sort().join('\n'))}
</script>
<div style="position:absolute;left:900px;top:30px;width:600px;height:300px;">
<div id="sysoutdiv" style="border:1px solid green;width:100%;height:95%;overflow:auto"></div>
This is System.out. <a href="javascript:testApplet._clearConsole()">clear it</a> <br/>Add ?j2snocore to URL to see full class list; ?j2sdebug to use uncompressed j2s/core files <br/><a href="javascript:getClassList()">get _j2sClassList.txt</a>
</div>
</body>
</html>
